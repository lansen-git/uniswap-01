{"ast":null,"code":"import _slicedToArray from\"C:\\\\Users\\\\lansen\\\\Desktop\\\\uniswap-front-interface\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";import _defineProperty from\"C:\\\\Users\\\\lansen\\\\Desktop\\\\uniswap-front-interface\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/defineProperty\";import useENS from'../../hooks/useENS';import{Version}from'../../hooks/useToggledVersion';import{parseUnits}from'@ethersproject/units';import{CurrencyAmount,ETHER,JSBI,Token,TokenAmount}from'@uniswap/sdk';import{useCallback,useEffect,useState}from'react';import{useDispatch,useSelector}from'react-redux';import{useV1Trade}from'../../data/V1';import{useActiveWeb3React}from'../../hooks';import{useCurrency}from'../../hooks/Tokens';import{useTradeExactIn,useTradeExactOut}from'../../hooks/Trades';import useParsedQueryString from'../../hooks/useParsedQueryString';import{isAddress}from'../../utils';import{useCurrencyBalances}from'../wallet/hooks';import{Field,replaceSwapState,selectCurrency,setRecipient,switchCurrencies,typeInput}from'./actions';import useToggledVersion from'../../hooks/useToggledVersion';import{useUserSlippageTolerance}from'../user/hooks';import{computeSlippageAdjustedAmounts}from'../../utils/prices';export function useSwapState(){return useSelector(function(state){return state.swap;});}export function useSwapActionHandlers(){var dispatch=useDispatch();var onCurrencySelection=useCallback(function(field,currency){dispatch(selectCurrency({field:field,currencyId:currency instanceof Token?currency.address:currency===ETHER?'ETH':''}));},[dispatch]);var onSwitchTokens=useCallback(function(){dispatch(switchCurrencies());},[dispatch]);var onUserInput=useCallback(function(field,typedValue){dispatch(typeInput({field:field,typedValue:typedValue}));},[dispatch]);var onChangeRecipient=useCallback(function(recipient){dispatch(setRecipient({recipient:recipient}));},[dispatch]);return{onSwitchTokens:onSwitchTokens,onCurrencySelection:onCurrencySelection,onUserInput:onUserInput,onChangeRecipient:onChangeRecipient};}// try to parse a user entered amount for a given token\nexport function tryParseAmount(value,currency){if(!value||!currency){return undefined;}try{var typedValueParsed=parseUnits(value,currency.decimals).toString();if(typedValueParsed!=='0'){return currency instanceof Token?new TokenAmount(currency,JSBI.BigInt(typedValueParsed)):CurrencyAmount.ether(JSBI.BigInt(typedValueParsed));}}catch(error){// should fail if the user specifies too many decimal places of precision (or maybe exceed max uint?)\nconsole.debug(\"Failed to parse input amount: \\\"\".concat(value,\"\\\"\"),error);}// necessary for all paths to return a value\nreturn undefined;}var BAD_RECIPIENT_ADDRESSES=['0x527ebd73a64b96100b7aae6bdde4b876947d370b',// v2 factory\n'0xd101544cd6e7216b40ca76fb8ea79eb86f7c1fdd',// v2 router 01\n'0xd101544cd6e7216b40ca76fb8ea79eb86f7c1fdd'// v2 router 02\n];/**\r\n * Returns true if any of the pairs or tokens in a trade have the given checksummed address\r\n * @param trade to check for the given address\r\n * @param checksummedAddress address to check in the pairs and tokens\r\n */function involvesAddress(trade,checksummedAddress){return trade.route.path.some(function(token){return token.address===checksummedAddress;})||trade.route.pairs.some(function(pair){return pair.liquidityToken.address===checksummedAddress;});}// from the current swap inputs, compute the best trade and return it.\nexport function useDerivedSwapInfo(){var _ref,_ref2,_currencyBalances,_currencies;var _useActiveWeb3React=useActiveWeb3React(),account=_useActiveWeb3React.account;var toggledVersion=useToggledVersion();var _useSwapState=useSwapState(),independentField=_useSwapState.independentField,typedValue=_useSwapState.typedValue,inputCurrencyId=_useSwapState[Field.INPUT].currencyId,outputCurrencyId=_useSwapState[Field.OUTPUT].currencyId,recipient=_useSwapState.recipient;var inputCurrency=useCurrency(inputCurrencyId);var outputCurrency=useCurrency(outputCurrencyId);var recipientLookup=useENS(recipient!==null&&recipient!==void 0?recipient:undefined);var to=(_ref=recipient===null?account:recipientLookup.address)!==null&&_ref!==void 0?_ref:null;var relevantTokenBalances=useCurrencyBalances(account!==null&&account!==void 0?account:undefined,[inputCurrency!==null&&inputCurrency!==void 0?inputCurrency:undefined,outputCurrency!==null&&outputCurrency!==void 0?outputCurrency:undefined]);var isExactIn=independentField===Field.INPUT;var parsedAmount=tryParseAmount(typedValue,(_ref2=isExactIn?inputCurrency:outputCurrency)!==null&&_ref2!==void 0?_ref2:undefined);var bestTradeExactIn=useTradeExactIn(isExactIn?parsedAmount:undefined,outputCurrency!==null&&outputCurrency!==void 0?outputCurrency:undefined);var bestTradeExactOut=useTradeExactOut(inputCurrency!==null&&inputCurrency!==void 0?inputCurrency:undefined,!isExactIn?parsedAmount:undefined);var v2Trade=isExactIn?bestTradeExactIn:bestTradeExactOut;var currencyBalances=(_currencyBalances={},_defineProperty(_currencyBalances,Field.INPUT,relevantTokenBalances[0]),_defineProperty(_currencyBalances,Field.OUTPUT,relevantTokenBalances[1]),_currencyBalances);var currencies=(_currencies={},_defineProperty(_currencies,Field.INPUT,inputCurrency!==null&&inputCurrency!==void 0?inputCurrency:undefined),_defineProperty(_currencies,Field.OUTPUT,outputCurrency!==null&&outputCurrency!==void 0?outputCurrency:undefined),_currencies);// get link to trade on v1, if a better rate exists\nvar v1Trade=useV1Trade(isExactIn,currencies[Field.INPUT],currencies[Field.OUTPUT],parsedAmount);var inputError;if(!account){inputError='Connect Wallet';}if(!parsedAmount){var _inputError;inputError=(_inputError=inputError)!==null&&_inputError!==void 0?_inputError:'Enter an amount';}if(!currencies[Field.INPUT]||!currencies[Field.OUTPUT]){var _inputError2;inputError=(_inputError2=inputError)!==null&&_inputError2!==void 0?_inputError2:'Select a token';}var formattedTo=isAddress(to);if(!to||!formattedTo){var _inputError3;inputError=(_inputError3=inputError)!==null&&_inputError3!==void 0?_inputError3:'Enter a recipient';}else{if(BAD_RECIPIENT_ADDRESSES.indexOf(formattedTo)!==-1||bestTradeExactIn&&involvesAddress(bestTradeExactIn,formattedTo)||bestTradeExactOut&&involvesAddress(bestTradeExactOut,formattedTo)){var _inputError4;inputError=(_inputError4=inputError)!==null&&_inputError4!==void 0?_inputError4:'Invalid recipient';}}var _useUserSlippageToler=useUserSlippageTolerance(),_useUserSlippageToler2=_slicedToArray(_useUserSlippageToler,1),allowedSlippage=_useUserSlippageToler2[0];var slippageAdjustedAmounts=v2Trade&&allowedSlippage&&computeSlippageAdjustedAmounts(v2Trade,allowedSlippage);var slippageAdjustedAmountsV1=v1Trade&&allowedSlippage&&computeSlippageAdjustedAmounts(v1Trade,allowedSlippage);// compare input balance to max input based on version\nvar _ref3=[currencyBalances[Field.INPUT],toggledVersion===Version.v1?slippageAdjustedAmountsV1?slippageAdjustedAmountsV1[Field.INPUT]:null:slippageAdjustedAmounts?slippageAdjustedAmounts[Field.INPUT]:null],balanceIn=_ref3[0],amountIn=_ref3[1];if(balanceIn&&amountIn&&balanceIn.lessThan(amountIn)){inputError='Insufficient '+amountIn.currency.symbol+' balance';}return{currencies:currencies,currencyBalances:currencyBalances,parsedAmount:parsedAmount,v2Trade:v2Trade!==null&&v2Trade!==void 0?v2Trade:undefined,inputError:inputError,v1Trade:v1Trade};}function parseCurrencyFromURLParameter(urlParam){var _ETH;if(typeof urlParam==='string'){var valid=isAddress(urlParam);if(valid)return valid;if(urlParam.toUpperCase()==='ETH')return'ETH';if(valid===false)return'ETH';}return(_ETH='ETH')!==null&&_ETH!==void 0?_ETH:'';}function parseTokenAmountURLParameter(urlParam){return typeof urlParam==='string'&&!isNaN(parseFloat(urlParam))?urlParam:'';}function parseIndependentFieldURLParameter(urlParam){return typeof urlParam==='string'&&urlParam.toLowerCase()==='output'?Field.OUTPUT:Field.INPUT;}var ENS_NAME_REGEX=/^[-a-zA-Z0-9@:%._+~#=]{1,256}\\.[a-zA-Z0-9()]{1,6}\\b([-a-zA-Z0-9()@:%_+.~#?&/=]*)?$/;var ADDRESS_REGEX=/^0x[a-fA-F0-9]{40}$/;function validatedRecipient(recipient){if(typeof recipient!=='string')return null;var address=isAddress(recipient);if(address)return address;if(ENS_NAME_REGEX.test(recipient))return recipient;if(ADDRESS_REGEX.test(recipient))return recipient;return null;}export function queryParametersToSwapState(parsedQs){var _ref4;var inputCurrency=parseCurrencyFromURLParameter(parsedQs.inputCurrency);var outputCurrency=parseCurrencyFromURLParameter(parsedQs.outputCurrency);if(inputCurrency===outputCurrency){if(typeof parsedQs.outputCurrency==='string'){inputCurrency='';}else{outputCurrency='';}}var recipient=validatedRecipient(parsedQs.recipient);return _ref4={},_defineProperty(_ref4,Field.INPUT,{currencyId:inputCurrency}),_defineProperty(_ref4,Field.OUTPUT,{currencyId:outputCurrency}),_defineProperty(_ref4,\"typedValue\",parseTokenAmountURLParameter(parsedQs.exactAmount)),_defineProperty(_ref4,\"independentField\",parseIndependentFieldURLParameter(parsedQs.exactField)),_defineProperty(_ref4,\"recipient\",recipient),_ref4;}// updates the swap state to use the defaults for a given network\nexport function useDefaultsFromURLSearch(){var _useActiveWeb3React2=useActiveWeb3React(),chainId=_useActiveWeb3React2.chainId;var dispatch=useDispatch();var parsedQs=useParsedQueryString();var _useState=useState(),_useState2=_slicedToArray(_useState,2),result=_useState2[0],setResult=_useState2[1];useEffect(function(){if(!chainId)return;var parsed=queryParametersToSwapState(parsedQs);dispatch(replaceSwapState({typedValue:parsed.typedValue,field:parsed.independentField,inputCurrencyId:parsed[Field.INPUT].currencyId,outputCurrencyId:parsed[Field.OUTPUT].currencyId,recipient:parsed.recipient}));setResult({inputCurrencyId:parsed[Field.INPUT].currencyId,outputCurrencyId:parsed[Field.OUTPUT].currencyId});// eslint-disable-next-line react-hooks/exhaustive-deps\n},[dispatch,chainId]);return result;}","map":{"version":3,"sources":["C:/Users/lansen/Desktop/uniswap-front-interface/src/state/swap/hooks.ts"],"names":["useENS","Version","parseUnits","CurrencyAmount","ETHER","JSBI","Token","TokenAmount","useCallback","useEffect","useState","useDispatch","useSelector","useV1Trade","useActiveWeb3React","useCurrency","useTradeExactIn","useTradeExactOut","useParsedQueryString","isAddress","useCurrencyBalances","Field","replaceSwapState","selectCurrency","setRecipient","switchCurrencies","typeInput","useToggledVersion","useUserSlippageTolerance","computeSlippageAdjustedAmounts","useSwapState","state","swap","useSwapActionHandlers","dispatch","onCurrencySelection","field","currency","currencyId","address","onSwitchTokens","onUserInput","typedValue","onChangeRecipient","recipient","tryParseAmount","value","undefined","typedValueParsed","decimals","toString","BigInt","ether","error","console","debug","BAD_RECIPIENT_ADDRESSES","involvesAddress","trade","checksummedAddress","route","path","some","token","pairs","pair","liquidityToken","useDerivedSwapInfo","account","toggledVersion","independentField","inputCurrencyId","INPUT","outputCurrencyId","OUTPUT","inputCurrency","outputCurrency","recipientLookup","to","relevantTokenBalances","isExactIn","parsedAmount","bestTradeExactIn","bestTradeExactOut","v2Trade","currencyBalances","currencies","v1Trade","inputError","formattedTo","indexOf","allowedSlippage","slippageAdjustedAmounts","slippageAdjustedAmountsV1","v1","balanceIn","amountIn","lessThan","symbol","parseCurrencyFromURLParameter","urlParam","valid","toUpperCase","parseTokenAmountURLParameter","isNaN","parseFloat","parseIndependentFieldURLParameter","toLowerCase","ENS_NAME_REGEX","ADDRESS_REGEX","validatedRecipient","test","queryParametersToSwapState","parsedQs","exactAmount","exactField","useDefaultsFromURLSearch","chainId","result","setResult","parsed"],"mappings":"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","sourcesContent":["import useENS from '../../hooks/useENS'\r\nimport { Version } from '../../hooks/useToggledVersion'\r\nimport { parseUnits } from '@ethersproject/units'\r\nimport { Currency, CurrencyAmount, ETHER, JSBI, Token, TokenAmount, Trade } from '@uniswap/sdk'\r\nimport { ParsedQs } from 'qs'\r\nimport { useCallback, useEffect, useState } from 'react'\r\nimport { useDispatch, useSelector } from 'react-redux'\r\nimport { useV1Trade } from '../../data/V1'\r\nimport { useActiveWeb3React } from '../../hooks'\r\nimport { useCurrency } from '../../hooks/Tokens'\r\nimport { useTradeExactIn, useTradeExactOut } from '../../hooks/Trades'\r\nimport useParsedQueryString from '../../hooks/useParsedQueryString'\r\nimport { isAddress } from '../../utils'\r\nimport { AppDispatch, AppState } from '../index'\r\nimport { useCurrencyBalances } from '../wallet/hooks'\r\nimport { Field, replaceSwapState, selectCurrency, setRecipient, switchCurrencies, typeInput } from './actions'\r\nimport { SwapState } from './reducer'\r\nimport useToggledVersion from '../../hooks/useToggledVersion'\r\nimport { useUserSlippageTolerance } from '../user/hooks'\r\nimport { computeSlippageAdjustedAmounts } from '../../utils/prices'\r\n\r\nexport function useSwapState(): AppState['swap'] {\r\n  return useSelector<AppState, AppState['swap']>(state => state.swap)\r\n}\r\n\r\nexport function useSwapActionHandlers(): {\r\n  onCurrencySelection: (field: Field, currency: Currency) => void\r\n  onSwitchTokens: () => void\r\n  onUserInput: (field: Field, typedValue: string) => void\r\n  onChangeRecipient: (recipient: string | null) => void\r\n} {\r\n  const dispatch = useDispatch<AppDispatch>()\r\n  const onCurrencySelection = useCallback(\r\n    (field: Field, currency: Currency) => {\r\n      dispatch(\r\n        selectCurrency({\r\n          field,\r\n          currencyId: currency instanceof Token ? currency.address : currency === ETHER ? 'ETH' : ''\r\n        })\r\n      )\r\n    },\r\n    [dispatch]\r\n  )\r\n\r\n  const onSwitchTokens = useCallback(() => {\r\n    dispatch(switchCurrencies())\r\n  }, [dispatch])\r\n\r\n  const onUserInput = useCallback(\r\n    (field: Field, typedValue: string) => {\r\n      dispatch(typeInput({ field, typedValue }))\r\n    },\r\n    [dispatch]\r\n  )\r\n\r\n  const onChangeRecipient = useCallback(\r\n    (recipient: string | null) => {\r\n      dispatch(setRecipient({ recipient }))\r\n    },\r\n    [dispatch]\r\n  )\r\n\r\n  return {\r\n    onSwitchTokens,\r\n    onCurrencySelection,\r\n    onUserInput,\r\n    onChangeRecipient\r\n  }\r\n}\r\n\r\n// try to parse a user entered amount for a given token\r\nexport function tryParseAmount(value?: string, currency?: Currency): CurrencyAmount | undefined {\r\n  if (!value || !currency) {\r\n    return undefined\r\n  }\r\n  try {\r\n    const typedValueParsed = parseUnits(value, currency.decimals).toString()\r\n    if (typedValueParsed !== '0') {\r\n      return currency instanceof Token\r\n        ? new TokenAmount(currency, JSBI.BigInt(typedValueParsed))\r\n        : CurrencyAmount.ether(JSBI.BigInt(typedValueParsed))\r\n    }\r\n  } catch (error) {\r\n    // should fail if the user specifies too many decimal places of precision (or maybe exceed max uint?)\r\n    console.debug(`Failed to parse input amount: \"${value}\"`, error)\r\n  }\r\n  // necessary for all paths to return a value\r\n  return undefined\r\n}\r\n\r\nconst BAD_RECIPIENT_ADDRESSES: string[] = [\r\n  '0x527ebd73a64b96100b7aae6bdde4b876947d370b', // v2 factory\r\n  '0xd101544cd6e7216b40ca76fb8ea79eb86f7c1fdd', // v2 router 01\r\n  '0xd101544cd6e7216b40ca76fb8ea79eb86f7c1fdd' // v2 router 02\r\n]\r\n\r\n/**\r\n * Returns true if any of the pairs or tokens in a trade have the given checksummed address\r\n * @param trade to check for the given address\r\n * @param checksummedAddress address to check in the pairs and tokens\r\n */\r\nfunction involvesAddress(trade: Trade, checksummedAddress: string): boolean {\r\n  return (\r\n    trade.route.path.some(token => token.address === checksummedAddress) ||\r\n    trade.route.pairs.some(pair => pair.liquidityToken.address === checksummedAddress)\r\n  )\r\n}\r\n\r\n// from the current swap inputs, compute the best trade and return it.\r\nexport function useDerivedSwapInfo(): {\r\n  currencies: { [field in Field]?: Currency }\r\n  currencyBalances: { [field in Field]?: CurrencyAmount }\r\n  parsedAmount: CurrencyAmount | undefined\r\n  v2Trade: Trade | undefined\r\n  inputError?: string\r\n  v1Trade: Trade | undefined\r\n} {\r\n  const { account } = useActiveWeb3React()\r\n\r\n  const toggledVersion = useToggledVersion()\r\n\r\n  const {\r\n    independentField,\r\n    typedValue,\r\n    [Field.INPUT]: { currencyId: inputCurrencyId },\r\n    [Field.OUTPUT]: { currencyId: outputCurrencyId },\r\n    recipient\r\n  } = useSwapState()\r\n\r\n  const inputCurrency = useCurrency(inputCurrencyId)\r\n  const outputCurrency = useCurrency(outputCurrencyId)\r\n  const recipientLookup = useENS(recipient ?? undefined)\r\n  const to: string | null = (recipient === null ? account : recipientLookup.address) ?? null\r\n\r\n  const relevantTokenBalances = useCurrencyBalances(account ?? undefined, [\r\n    inputCurrency ?? undefined,\r\n    outputCurrency ?? undefined\r\n  ])\r\n\r\n  const isExactIn: boolean = independentField === Field.INPUT\r\n  const parsedAmount = tryParseAmount(typedValue, (isExactIn ? inputCurrency : outputCurrency) ?? undefined)\r\n\r\n  const bestTradeExactIn = useTradeExactIn(isExactIn ? parsedAmount : undefined, outputCurrency ?? undefined)\r\n  const bestTradeExactOut = useTradeExactOut(inputCurrency ?? undefined, !isExactIn ? parsedAmount : undefined)\r\n\r\n  const v2Trade = isExactIn ? bestTradeExactIn : bestTradeExactOut\r\n\r\n  const currencyBalances = {\r\n    [Field.INPUT]: relevantTokenBalances[0],\r\n    [Field.OUTPUT]: relevantTokenBalances[1]\r\n  }\r\n\r\n  const currencies: { [field in Field]?: Currency } = {\r\n    [Field.INPUT]: inputCurrency ?? undefined,\r\n    [Field.OUTPUT]: outputCurrency ?? undefined\r\n  }\r\n\r\n  // get link to trade on v1, if a better rate exists\r\n  const v1Trade = useV1Trade(isExactIn, currencies[Field.INPUT], currencies[Field.OUTPUT], parsedAmount)\r\n\r\n  let inputError: string | undefined\r\n  if (!account) {\r\n    inputError = 'Connect Wallet'\r\n  }\r\n\r\n  if (!parsedAmount) {\r\n    inputError = inputError ?? 'Enter an amount'\r\n  }\r\n\r\n  if (!currencies[Field.INPUT] || !currencies[Field.OUTPUT]) {\r\n    inputError = inputError ?? 'Select a token'\r\n  }\r\n\r\n  const formattedTo = isAddress(to)\r\n  if (!to || !formattedTo) {\r\n    inputError = inputError ?? 'Enter a recipient'\r\n  } else {\r\n    if (\r\n      BAD_RECIPIENT_ADDRESSES.indexOf(formattedTo) !== -1 ||\r\n      (bestTradeExactIn && involvesAddress(bestTradeExactIn, formattedTo)) ||\r\n      (bestTradeExactOut && involvesAddress(bestTradeExactOut, formattedTo))\r\n    ) {\r\n      inputError = inputError ?? 'Invalid recipient'\r\n    }\r\n  }\r\n\r\n  const [allowedSlippage] = useUserSlippageTolerance()\r\n\r\n  const slippageAdjustedAmounts = v2Trade && allowedSlippage && computeSlippageAdjustedAmounts(v2Trade, allowedSlippage)\r\n\r\n  const slippageAdjustedAmountsV1 =\r\n    v1Trade && allowedSlippage && computeSlippageAdjustedAmounts(v1Trade, allowedSlippage)\r\n\r\n  // compare input balance to max input based on version\r\n  const [balanceIn, amountIn] = [\r\n    currencyBalances[Field.INPUT],\r\n    toggledVersion === Version.v1\r\n      ? slippageAdjustedAmountsV1\r\n        ? slippageAdjustedAmountsV1[Field.INPUT]\r\n        : null\r\n      : slippageAdjustedAmounts\r\n      ? slippageAdjustedAmounts[Field.INPUT]\r\n      : null\r\n  ]\r\n\r\n  if (balanceIn && amountIn && balanceIn.lessThan(amountIn)) {\r\n    inputError = 'Insufficient ' + amountIn.currency.symbol + ' balance'\r\n  }\r\n\r\n  return {\r\n    currencies,\r\n    currencyBalances,\r\n    parsedAmount,\r\n    v2Trade: v2Trade ?? undefined,\r\n    inputError,\r\n    v1Trade\r\n  }\r\n}\r\n\r\nfunction parseCurrencyFromURLParameter(urlParam: any): string {\r\n  if (typeof urlParam === 'string') {\r\n    const valid = isAddress(urlParam)\r\n    if (valid) return valid\r\n    if (urlParam.toUpperCase() === 'ETH') return 'ETH'\r\n    if (valid === false) return 'ETH'\r\n  }\r\n  return 'ETH' ?? ''\r\n}\r\n\r\nfunction parseTokenAmountURLParameter(urlParam: any): string {\r\n  return typeof urlParam === 'string' && !isNaN(parseFloat(urlParam)) ? urlParam : ''\r\n}\r\n\r\nfunction parseIndependentFieldURLParameter(urlParam: any): Field {\r\n  return typeof urlParam === 'string' && urlParam.toLowerCase() === 'output' ? Field.OUTPUT : Field.INPUT\r\n}\r\n\r\nconst ENS_NAME_REGEX = /^[-a-zA-Z0-9@:%._+~#=]{1,256}\\.[a-zA-Z0-9()]{1,6}\\b([-a-zA-Z0-9()@:%_+.~#?&/=]*)?$/\r\nconst ADDRESS_REGEX = /^0x[a-fA-F0-9]{40}$/\r\nfunction validatedRecipient(recipient: any): string | null {\r\n  if (typeof recipient !== 'string') return null\r\n  const address = isAddress(recipient)\r\n  if (address) return address\r\n  if (ENS_NAME_REGEX.test(recipient)) return recipient\r\n  if (ADDRESS_REGEX.test(recipient)) return recipient\r\n  return null\r\n}\r\n\r\nexport function queryParametersToSwapState(parsedQs: ParsedQs): SwapState {\r\n  let inputCurrency = parseCurrencyFromURLParameter(parsedQs.inputCurrency)\r\n  let outputCurrency = parseCurrencyFromURLParameter(parsedQs.outputCurrency)\r\n  if (inputCurrency === outputCurrency) {\r\n    if (typeof parsedQs.outputCurrency === 'string') {\r\n      inputCurrency = ''\r\n    } else {\r\n      outputCurrency = ''\r\n    }\r\n  }\r\n\r\n  const recipient = validatedRecipient(parsedQs.recipient)\r\n\r\n  return {\r\n    [Field.INPUT]: {\r\n      currencyId: inputCurrency\r\n    },\r\n    [Field.OUTPUT]: {\r\n      currencyId: outputCurrency\r\n    },\r\n    typedValue: parseTokenAmountURLParameter(parsedQs.exactAmount),\r\n    independentField: parseIndependentFieldURLParameter(parsedQs.exactField),\r\n    recipient\r\n  }\r\n}\r\n\r\n// updates the swap state to use the defaults for a given network\r\nexport function useDefaultsFromURLSearch():\r\n  | { inputCurrencyId: string | undefined; outputCurrencyId: string | undefined }\r\n  | undefined {\r\n  const { chainId } = useActiveWeb3React()\r\n  const dispatch = useDispatch<AppDispatch>()\r\n  const parsedQs = useParsedQueryString()\r\n  const [result, setResult] = useState<\r\n    { inputCurrencyId: string | undefined; outputCurrencyId: string | undefined } | undefined\r\n  >()\r\n\r\n  useEffect(() => {\r\n    if (!chainId) return\r\n    const parsed = queryParametersToSwapState(parsedQs)\r\n\r\n    dispatch(\r\n      replaceSwapState({\r\n        typedValue: parsed.typedValue,\r\n        field: parsed.independentField,\r\n        inputCurrencyId: parsed[Field.INPUT].currencyId,\r\n        outputCurrencyId: parsed[Field.OUTPUT].currencyId,\r\n        recipient: parsed.recipient\r\n      })\r\n    )\r\n\r\n    setResult({ inputCurrencyId: parsed[Field.INPUT].currencyId, outputCurrencyId: parsed[Field.OUTPUT].currencyId })\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [dispatch, chainId])\r\n\r\n  return result\r\n}\r\n"]},"metadata":{},"sourceType":"module"}